---
import { ui } from '@/lib/i18n';
import Icon from '@/components/common/Icon.astro';
import ScrollReveal from '@/components/common/ScrollReveal.astro';

const t = ui.en;

const contactInfo = [
  {
    label: t['contact.info.email'],
    value: 'joaopaulo.grv4@gmail.com',
    href: 'mailto:joaopaulo.grv4@gmail.com',
    icon: 'email' as const,
  },
  {
    label: t['contact.info.phone'],
    value: '+55 64 9 9957-2265',
    href: 'tel:+5564999572265',
    icon: 'phone' as const,
  },
  {
    label: t['contact.info.location'],
    value: 'Rio Verde, GO - Brazil',
    href: null,
    icon: 'location' as const,
  },
];
---

<section class="py-24 bg-[rgb(var(--color-bg-secondary))]">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
    <ScrollReveal animation="fade-up">
      <h2 class="text-3xl sm:text-4xl font-bold text-center mb-4">
        {t['contact.title']}
      </h2>
      <p class="text-center text-[rgb(var(--color-text-muted))] mb-16 max-w-2xl mx-auto">
        {t['contact.subtitle']}
      </p>
    </ScrollReveal>

    <div class="grid md:grid-cols-2 gap-12">
      <!-- Contact Form -->
      <ScrollReveal animation="fade-up" delay={100}>
        <div class="glass-card rounded-2xl p-8">
          <form id="contact-form" class="space-y-6">
            <!-- Web3Forms Access Key - Get yours at https://web3forms.com -->
            <input type="hidden" name="access_key" value="YOUR_WEB3FORMS_ACCESS_KEY" />
            <input type="hidden" name="subject" value="New Contact from Portfolio" />
            <input type="hidden" name="from_name" value="Portfolio Contact Form" />
            <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />

            <div>
              <label
                for="name"
                class="block text-sm font-medium text-[rgb(var(--color-text-secondary))] mb-2"
              >
                {t['contact.form.name']} <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                aria-required="true"
                class="w-full px-4 py-3 rounded-xl bg-[rgb(var(--color-bg-secondary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-primary))] placeholder-[rgb(var(--color-text-muted))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent transition-all"
                placeholder="Your name"
              />
              <p id="name-error" class="text-red-500 text-sm mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label
                for="email"
                class="block text-sm font-medium text-[rgb(var(--color-text-secondary))] mb-2"
              >
                {t['contact.form.email']} <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                aria-required="true"
                class="w-full px-4 py-3 rounded-xl bg-[rgb(var(--color-bg-secondary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-primary))] placeholder-[rgb(var(--color-text-muted))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent transition-all"
                placeholder="your@email.com"
              />
              <p id="email-error" class="text-red-500 text-sm mt-1 hidden" role="alert"></p>
            </div>

            <div>
              <label
                for="message"
                class="block text-sm font-medium text-[rgb(var(--color-text-secondary))] mb-2"
              >
                {t['contact.form.message']} <span class="text-red-500" aria-hidden="true">*</span>
              </label>
              <textarea
                id="message"
                name="message"
                rows="5"
                required
                aria-required="true"
                class="w-full px-4 py-3 rounded-xl bg-[rgb(var(--color-bg-secondary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-primary))] placeholder-[rgb(var(--color-text-muted))] focus:outline-none focus:ring-2 focus:ring-[rgb(var(--color-accent))] focus:border-transparent transition-all resize-none"
                placeholder="Your message..."
              ></textarea>
              <p id="message-error" class="text-red-500 text-sm mt-1 hidden" role="alert"></p>
            </div>

            <button
              type="submit"
              id="submit-btn"
              class="w-full px-6 py-4 bg-[rgb(var(--color-accent))] hover:bg-[rgb(var(--color-accent-hover))] text-white font-medium rounded-xl transition-all duration-200 hover:scale-[1.02] hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex items-center justify-center gap-2"
            >
              <span id="btn-text">{t['contact.form.send']}</span>
              <svg id="btn-spinner" class="hidden animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </button>

            <!-- Status Messages -->
            <div id="form-status" class="hidden" role="status" aria-live="polite">
              <div id="success-message" class="hidden p-4 rounded-xl bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 flex items-center gap-2">
                <Icon name="check" size={20} />
                <span>Message sent successfully! I'll get back to you soon.</span>
              </div>
              <div id="error-message" class="hidden p-4 rounded-xl bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200">
                <span>Something went wrong. Please try again or email me directly.</span>
              </div>
            </div>
          </form>
        </div>
      </ScrollReveal>

      <!-- Contact Info -->
      <ScrollReveal animation="fade-up" delay={200}>
        <div class="flex flex-col justify-center space-y-8">
          {
            contactInfo.map((info, index) => (
              <ScrollReveal animation="fade-left" delay={300 + index * 100} tag="div">
                <div class="flex items-start gap-4">
                  <div class="p-3 rounded-xl bg-[rgb(var(--color-accent)/0.1)] text-[rgb(var(--color-accent))]">
                    <Icon name={info.icon} size={24} />
                  </div>
                  <div>
                    <p class="text-sm text-[rgb(var(--color-text-muted))] mb-1">{info.label}</p>
                    {info.href ? (
                      <a
                        href={info.href}
                        class="text-lg font-medium text-[rgb(var(--color-text-primary))] hover:text-[rgb(var(--color-accent))] transition-colors"
                      >
                        {info.value}
                      </a>
                    ) : (
                      <p class="text-lg font-medium text-[rgb(var(--color-text-primary))]">
                        {info.value}
                      </p>
                    )}
                  </div>
                </div>
              </ScrollReveal>
            ))
          }

          <!-- Social Links -->
          <ScrollReveal animation="fade-left" delay={600} tag="div">
            <div class="pt-8 border-t border-[rgb(var(--color-border))]">
              <p class="text-sm text-[rgb(var(--color-text-muted))] mb-4">Connect with me</p>
              <div class="flex gap-4">
                <a
                  href="https://github.com/JPClow3"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="p-3 rounded-xl bg-[rgb(var(--color-bg-primary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-accent))] hover:border-[rgb(var(--color-accent)/0.5)] transition-all hover:scale-105"
                  aria-label="GitHub"
                >
                  <Icon name="github" size={20} />
                </a>
                <a
                  href="https://linkedin.com/in/joaopaulosantosgo"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="p-3 rounded-xl bg-[rgb(var(--color-bg-primary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-accent))] hover:border-[rgb(var(--color-accent)/0.5)] transition-all hover:scale-105"
                  aria-label="LinkedIn"
                >
                  <Icon name="linkedin" size={20} />
                </a>
                <a
                  href="https://www.instagram.com/_joao.paulo_sa/"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="p-3 rounded-xl bg-[rgb(var(--color-bg-primary))] border border-[rgb(var(--color-border))] text-[rgb(var(--color-text-secondary))] hover:text-[rgb(var(--color-accent))] hover:border-[rgb(var(--color-accent)/0.5)] transition-all hover:scale-105"
                  aria-label="Instagram"
                >
                  <Icon name="instagram" size={20} />
                </a>
              </div>
            </div>
          </ScrollReveal>
        </div>
      </ScrollReveal>
    </div>
  </div>
</section>

<script>
  function initContactForm() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    if (!form) return;

    const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
    const btnText = document.getElementById('btn-text');
    const btnSpinner = document.getElementById('btn-spinner');
    const formStatus = document.getElementById('form-status');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');

    // Validation functions
    function validateEmail(email: string): boolean {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function showError(fieldId: string, message: string) {
      const errorEl = document.getElementById(`${fieldId}-error`);
      const inputEl = document.getElementById(fieldId);
      if (errorEl && inputEl) {
        errorEl.textContent = message;
        errorEl.classList.remove('hidden');
        inputEl.setAttribute('aria-invalid', 'true');
        inputEl.classList.add('border-red-500');
      }
    }

    function clearError(fieldId: string) {
      const errorEl = document.getElementById(`${fieldId}-error`);
      const inputEl = document.getElementById(fieldId);
      if (errorEl && inputEl) {
        errorEl.classList.add('hidden');
        inputEl.removeAttribute('aria-invalid');
        inputEl.classList.remove('border-red-500');
      }
    }

    function validateForm(): boolean {
      let isValid = true;
      const name = (document.getElementById('name') as HTMLInputElement).value.trim();
      const email = (document.getElementById('email') as HTMLInputElement).value.trim();
      const message = (document.getElementById('message') as HTMLTextAreaElement).value.trim();

      // Clear previous errors
      ['name', 'email', 'message'].forEach(clearError);

      if (!name) {
        showError('name', 'Please enter your name');
        isValid = false;
      }

      if (!email) {
        showError('email', 'Please enter your email');
        isValid = false;
      } else if (!validateEmail(email)) {
        showError('email', 'Please enter a valid email address');
        isValid = false;
      }

      if (!message) {
        showError('message', 'Please enter a message');
        isValid = false;
      } else if (message.length < 10) {
        showError('message', 'Message must be at least 10 characters');
        isValid = false;
      }

      return isValid;
    }

    // Real-time validation
    ['name', 'email', 'message'].forEach((fieldId) => {
      const input = document.getElementById(fieldId);
      if (input) {
        input.addEventListener('blur', () => {
          if ((input as HTMLInputElement).value.trim()) {
            clearError(fieldId);
          }
        });
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Hide previous status messages
      if (formStatus) formStatus.classList.add('hidden');
      if (successMessage) successMessage.classList.add('hidden');
      if (errorMessage) errorMessage.classList.add('hidden');

      if (!validateForm()) return;

      // Show loading state
      if (submitBtn) submitBtn.disabled = true;
      if (btnText) btnText.textContent = 'Sending...';
      if (btnSpinner) btnSpinner.classList.remove('hidden');

      try {
        const formData = new FormData(form);
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          body: formData,
        });

        const result = await response.json();

        if (formStatus) formStatus.classList.remove('hidden');

        if (result.success) {
          if (successMessage) successMessage.classList.remove('hidden');
          form.reset();
        } else {
          if (errorMessage) errorMessage.classList.remove('hidden');
        }
      } catch (error) {
        if (formStatus) formStatus.classList.remove('hidden');
        if (errorMessage) errorMessage.classList.remove('hidden');
      } finally {
        // Reset button state
        if (submitBtn) submitBtn.disabled = false;
        if (btnText) btnText.textContent = 'Send Message';
        if (btnSpinner) btnSpinner.classList.add('hidden');
      }
    });
  }

  // Initialize on load
  initContactForm();

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initContactForm);
</script>
